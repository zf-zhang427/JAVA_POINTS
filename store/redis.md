#### redis是什么？

一个高性能，支持多种数据类型，各种缓存淘汰策略，并提供一定持久化能力的缓存服务。



#### 为什么用redis？

- **内存存储：**Redis是**基于内存存储的非关系型数据库**，MySQL是基于磁盘存储的关系型数据库。由于**内存存储速度快，Redis能够更快地读取和写入数据**，而无需像MySQL那样频繁进行磁盘I/O操作。
- **简单数据结构：**Redis是**基于键值对存储**数据的，支持简单的数据结构，因此在某些场景下Redis的数据操作更为简单高效，比如Redis用哈希表查询，只需要O1时间复杂度，而MySQL引擎的。
- **线程模型：**Redis采用单线程模型可以避免了多线程之间的竞争，省去了多线程切换带来的时间和性能上的开销，而且也不会导致死锁问题。



#### redis底层的数据结构

Redis的存储结构是MAP(key - value)，其中支持的数据类型：String（字符串)，Hash(哈希)，List（列表)，Set(集合)、Zset(有序集合)、stream流



#### 线程

##### 单线程接收

Redis单线程指的是【接收客户端请求 -> 解析请求 -> 进行**数据读写等操作** -> 发送数据给客户端】这个过程是由单线程来完成。

<img src="../assets/redis/redis单线程.png" style="zoom:60%;" />

##### 多线程处理

redis在进行数据淘汰策略与消息队列时使用多线程技术。

<img src="../assets/redis/任务队列.png" style="zoom:75%;" />

对数据的GET、SET方法是单线程的，其他额外步骤由其他线程负责，所以需要保证原子性（通过lua脚本）

- lua脚本

  由于Lua脚本在Redis中是**从头到尾连续执行**的，在脚本执行期间**不会被其他命令打断**，因此可以用来实现复杂的业务逻辑而不必担心并发问题。



#### 内存处理策略

- 过期删除

  对已过期键值对进行删除

  - 逻辑过期：给缓存数据**添加过期时间**，在访问时先判断过期时间，若**过期直接删除**(后续会查找mysql数据并返回新版)

- 内存淘汰

  内存满了后触发，依据策略淘汰一部分内存，主要是以下两大策略：

  - **LRU：**最近最少使用数据，将其删除
  - **LFU：**最少频率使用的数据，将其删除
  - 范围（volatile：设置了过期时间；allkey：所有数据）



#### 持久化

- RDB(快照)

  **生成快照**，通过异步子进程定期将内存数据持久化到磁盘文件，**优点是恢复快，缺点是会有数据丢失(快照有时间间隔)**

- AOP(追加)

​       以**追加**的方式，把操作命令写入磁盘，重启时**逐一执行命令**来进行恢复，优点是**保存完整**，缺点是**恢复慢(逐一执行)**



#### 分布式锁

