第一章

```
在这个模块中，我设计了一个动态白名单机制，用于过滤 Kafka 中不需要处理的消息，将单条消息处理耗时从 3200ms 降到 19ms。

核心技术有三点：

第一，使用 CopyOnWriteArraySet 存储白名单。因为它读操作无锁，在每秒数万次 isFundAllowed() 判断的场景下性能极高。虽然写操作会复制数组，但由于配置变更极少，完全可以接受。

第二，提供 REST API 实现热更新。支持通过 POST /add 添加 ID。接口设计上考虑了幂等性（Set 自带去重）、安全性（JWT 认证、IP 白名单、限流）和操作审计，具备生产可用性。

第三，解决重启丢失问题。我们采用 Redis 持久化方案：启动时从 Redis 加载白名单到内存；运行时双写 Redis 和内存集合，保证多实例间状态一致。若 Redis 写入失败，则拒绝操作，防止状态不一致。

这套方案兼顾了性能、可用性和可维护性，后续也可平滑迁移到 Nacos 等配置中心。
```